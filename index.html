<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="/clasome_logo.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Clatalk" />
  <link rel="manifest" href="/manifest.json" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <title>클라톡</title>
</head>
<body>
  <noscript>클라톡</noscript>
  <div id="root"></div>
  <button id="install-button" style="display: none;" onclick="installApp()">설치</button>
  <script type="module" src="/src/index.jsx"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/service-worker.js').then(function(registration) {
          console.log('ServiceWorker registration successful with scope: ', registration.scope);
        }, function(error) {
          console.log('ServiceWorker registration failed: ', error);
        });
      });
    }

    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', function(event) {
      event.preventDefault();
      deferredPrompt = event;
      document.getElementById('install-button').style.display = 'block';
    });

    function installApp() {
      if (!deferredPrompt) {
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) && navigator.share) {         
          let varUA = navigator.userAgent.toLowerCase();
          if (varUA.indexOf("iphone") > -1 || varUA.indexOf("ipad") > -1 || varUA.indexOf("ipod") > -1) {
            alert("사파리에서 \"공유하기\"에서 \"홈 화면에 추가\"를 통해 설치하실 수 있습니다.");
            return;
          }
        }
        alert('이미 앱이 설치되어 있거나 앱을 설치할 수 없는 환경입니다.');
        return;
      }

      deferredPrompt.prompt();
      deferredPrompt.userChoice.then((choiceResult) => {
        if (choiceResult.outcome === 'accepted') {
          console.log('User accepted the install prompt');
        } else {
          console.log('User dismissed the install prompt');
        }
        deferredPrompt = null;
      });
    }
  </script>
</body>
</html>
